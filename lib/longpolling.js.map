{"version":3,"sources":["../src/longpolling.js"],"names":["LongPolling","constructor","httpPack","scope","_pushStream","bind","isDestroyed","_read","size","generateBody","then","respondBody","undefined","length","push","handle","setTimeout","start","ctx","body","destroy","clearTimeout"],"mappings":";;;;;;AAAA;;AAEe,MAAMA,WAAN,0BAAkC;AAC7CC,gBAAYC,QAAZ,EAAsBC,KAAtB,EAA4B;AACxB;AACA,aAAKD,QAAL,GAAgBA,QAAhB;AACA,aAAKC,KAAL,GAAaA,KAAb;AACA,aAAKC,WAAL,GAAmB,KAAKA,WAAL,CAAiBC,IAAjB,CAAsB,IAAtB,CAAnB;AACA,aAAKC,WAAL,GAAmB,KAAnB;AACH;;AAEDC,UAAMC,IAAN,EAAW,CAEV;;AAEDJ,kBAAa;AACT,aAAKF,QAAL,CAAcO,YAAd,CAA2B,KAAKN,KAAhC,EAAuCO,IAAvC,CAA4C,UAASC,WAAT,EAAqB;AAC7D,gBAAGA,eAAeC,SAAf,IAA4BD,YAAYE,MAAZ,GAAqB,CAApD,EAAsD;AAClD,qBAAKC,IAAL,CAAUH,WAAV;AACH;AACJ,SAJ2C,CAI1CN,IAJ0C,CAIrC,IAJqC,CAA5C,EAIcK,IAJd,CAImB,YAAU;AACzB,gBAAG,CAAC,KAAKJ,WAAT,EAAqB;AACjB,qBAAKS,MAAL,GAAcC,WAAW,KAAKZ,WAAhB,EAA6B,IAA7B,CAAd;AACH;AACJ,SAJkB,CAIjBC,IAJiB,CAIZ,IAJY,CAJnB;AASH;;AAEDY,UAAMC,GAAN,EAAU;AACN,YAAG,KAAKZ,WAAR,EAAoB;AAChB;AACH;AACDY,YAAIC,IAAJ,GAAW,IAAX;AACA,aAAKJ,MAAL,GAAcC,WAAW,KAAKZ,WAAhB,EAA6B,IAA7B,CAAd;AACH;;AAEDgB,cAAS;AACL,aAAKd,WAAL,GAAmB,IAAnB;AACA,YAAG,KAAKS,MAAL,IAAeH,SAAlB,EAA4B;AACxBS,yBAAa,KAAKN,MAAlB;AACH;AACJ;AAtC4C;kBAA5Bf,W","file":"longpolling.js","sourcesContent":["import {Readable} from 'stream';\n\nexport default class LongPolling extends Readable{\n    constructor(httpPack, scope){\n        super();\n        this.httpPack = httpPack;\n        this.scope = scope;\n        this._pushStream = this._pushStream.bind(this);\n        this.isDestroyed = false;\n    }\n\n    _read(size){\n\n    }\n\n    _pushStream(){\n        this.httpPack.generateBody(this.scope).then(function(respondBody){\n            if(respondBody != undefined && respondBody.length > 0){\n                this.push(respondBody);\n            }\n        }.bind(this)).then(function(){\n            if(!this.isDestroyed){\n                this.handle = setTimeout(this._pushStream, 1000);\n            }\n        }.bind(this));\n    }\n\n    start(ctx){\n        if(this.isDestroyed){\n            return;\n        }\n        ctx.body = this;\n        this.handle = setTimeout(this._pushStream, 1000);\n    }\n\n    destroy(){\n        this.isDestroyed = true;\n        if(this.handle != undefined){\n            clearTimeout(this.handle);\n        }\n    }\n}"]}